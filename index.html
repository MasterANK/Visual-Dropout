<!DOCTYPE html>
<html>
    <head>
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <link rel="stylesheet" href="https://pyscript.net/latest/pyscript.css" />
        <script defer src="https://pyscript.net/latest/pyscript.js"></script>

        <script src='https://cdn.plot.ly/plotly-2.26.0.min.js'></script>
        <link rel="stylesheet" type="text/css" href="https://raw.githack.com/MasterANK/Visual-Dropout/main/basestyle.css" />
    </head>

    <body>
        <div id="table-container"></div>
        <div class=center><p>All Categories - Classes I-V</p></div>
        <div id="plot-containers">
            <div id="plot-column">
                <div id="plot1" class="plots"></div>
                <div id="plot2" class="plots"></div>
            </div>
            <div id="centered-image">
                <div id="plot3"></div>
            </div>
        </div>

        <py-config>
            packages = [
              "pandas",
              "plotly"
            ]
        </py-config>

        <py-script>
            import pandas as pd
            from pyodide.http import open_url
            import plotly.express as px
            import plotly.graph_objs as go
            import plotly
            import json
            import js
            import html

            #csv linking below
            url = 'https://raw.githubusercontent.com/MasterANK/Visual-Dropout/main/Statement_SES_2010-11-DropOut.csv'
            url_content = open_url(url)

            #dataframe building
            rcsv = pd.read_csv(url_content)
            df = pd.DataFrame(rcsv)

            #table work below
            html_table = df.to_html(classes="dataih",index=False)
            Element("table-container").element.innerHTML= html_table

            ##plotly All Categories - Classes I-V Drawings#
            #line plot
            fig= px.line(df, x='Year', y=['All Categories - Classes I-V - Boys','All Categories - Classes I-V - Girls'], markers =True)
            graphJSON = json.dumps(fig, cls=plotly.utils.PlotlyJSONEncoder)
            js.Plotly.newPlot("plot1", js.JSON.parse(graphJSON))


            #pie plot
            avg_boys = df['All Categories - Classes I-V - Boys'].sum()/len(df['Year'])
            avg_girls = df['All Categories - Classes I-V - Girls'].sum()/len(df['Year'])
            fig = px.pie(values=[avg_boys,avg_girls], names=['Boys','Girls'])
            graphJSON = json.dumps(fig, cls=plotly.utils.PlotlyJSONEncoder)
            js.Plotly.newPlot("plot2", js.JSON.parse(graphJSON))

            #bar graph
            fig = px.bar(df,x='Year',y='All Categories - Classes I-V - Total',width=800, height=400)
            fig.update_layout(yaxis_range=[0,100])
            graphJSON = json.dumps(fig, cls=plotly.utils.PlotlyJSONEncoder)
            js.Plotly.newPlot("plot3", js.JSON.parse(graphJSON))
        </py-script>

    </body>

</html>